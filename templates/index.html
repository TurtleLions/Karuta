<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Karuta Player</title>
</head>
<body>
    <h1>Karuta Player</h1>

    <input type="text" id="playlistUrl" placeholder="Enter YouTube playlist URL">
    <button id="runScript">Download Playlist</button>

    <h2>Songs</h2>
    <ul id="songList"></ul>

    <audio id="audioPlayer" controls></audio>

    <script>
        async function fetchSongs() {
            const res = await fetch("/get-songs");
            const data = await res.json();

            const list = document.getElementById("songList");
            list.innerHTML = "";

            data.songs.forEach(song => {
                const li = document.createElement("li");
                li.innerText = song.name;
                li.onclick = async () => {
                    const fileRes = await fetch(`/songs/${song.url}`);
                    const fileData = await fileRes.json();
                    document.getElementById("audioPlayer").src = fileData.url;
                    document.getElementById("audioPlayer").play();
                };
                list.appendChild(li);
            });
        }

        document.getElementById("runScript").addEventListener("click", async () => {
            const playlistUrl = document.getElementById("playlistUrl").value;
            await fetch("/run-script", { method: "POST", body: JSON.stringify({ playlist_url: playlistUrl }) });
        });

        fetchSongs();
    </script>
</body>
</html>
